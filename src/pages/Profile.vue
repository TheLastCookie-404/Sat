<template>
  <div>{{ message }}</div>
  <button class="btn" @click="() => getIin()">
    <span>Предъявить</span>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24">
      <g fill="none" fill-rule="evenodd" clip-rule="evenodd">
        <path
          fill="#8fbffa"
          d="M2 1H1v8h2V3h6V1zm0 22H1v-8h2v6h6v2zM23 1v8h-2V3h-6V1zm0 21v1h-8v-2h6v-6h2z" />
        <path
          fill="#2859c5"
          d="M5 10v1h6V5H5zm4-1H7V7h2zm4 1v1h6V5h-6zm4-1h-2V7h2zM5 19v-6h6v6zm2-2h2v-2H7zm6 .5V19h6v-2h-4v-4h-2zm4-4.5v2h2v-2z" />
      </g>
    </svg>
  </button>
  <QrcodeVue
    :value="qrCode"
    :size="150"
    level="H"
    render-as="svg"
    class="m-5" />
</template>

<script lang="ts" setup>
  import { ref, onBeforeMount, shallowRef } from "vue";
  import { useLocalStorage } from "@vueuse/core";
  import axios from "axios";

  import QrcodeVue from "qrcode.vue";

  const message = ref<string>();
  const qrCode = shallowRef<string>(
    "https://darling-fun-krill.ngrok-free.app/transaction"
  );
  const accessToken = useLocalStorage<string>("AccessToken", "");

  const requestConfig = {
    headers: {
      Authorization: `Bearer ${accessToken.value}`,
    },
  };

  onBeforeMount(() => {
    test();
  });

  function test() {
    axios
      .get("https://bolash.uniong.ru/api/v1", requestConfig)
      .then((response) => {
        console.log(response);
        message.value = response.data.message;
      })
      .catch((error) => {
        console.error(error);
      });
  }

  function getIin() {
    axios
      .get("https://bolash.uniong.ru/api/v1/iin", requestConfig)
      .then((response) => {
        console.log(response);
        qrCode.value = `${qrCode.value}/${response.data.message}`;
      })
      .catch((error) => {
        console.error(error);
      });
  }
</script>
